<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Never-Ending Elevator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent scrollbars */
            position: relative;
        }

        /* The scrolling background provides a basic sense of motion */
        .scrolling-background {
            position: absolute;
            top: -50%;
            width: 100%;
            height: 200%;
            background: #1a202c; /* Solid dark color is better with new visuals */
            z-index: -1;
        }

        .elevator-shaft {
            position: relative;
            width: 200px;
            height: 600px;
            background-color: #3f51b5; /* Blue-grey shaft */
            border: 8px solid #2a3d7a;
            border-radius: 1rem;
            overflow: hidden; /* Crucial for containing the visuals */
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        
        #visualsContainer {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1; /* Behind the elevator car */
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
        }

        .rock {
            position: absolute;
            /* Brownish color set in JS for variety */
        }

        .elevator-car {
            position: absolute;
            width: 180px;
            height: 100px;
            background-color: #7b92df; /* Lighter blue-grey car */
            border: 4px solid #5a6fa2;
            border-radius: 0.5rem;
            left: 50%;
            top: 50%; /* Start vertically centered */
            transform: translate(-50%, -50%) translateY(0px);
            transition: none;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            z-index: 2; /* In front of the visuals */
        }

        .button {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s ease-in-out;
            border: none;
            outline: none;
        }
        .button-up {
            background-color: #4CAF50; /* Green */
        }
        .button-down {
            background-color: #F44336; /* Red */
        }
        .button-music {
            background-color: #2196F3; /* Blue */
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        .button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="scrollingBackground" class="scrolling-background"></div>

    <div class="flex flex-col items-center justify-center space-y-8 p-4 z-10">
        <h1 class="text-3xl font-extrabold text-white mb-6 text-center">Never-Ending Elevator</h1>
        <div class="relative flex items-center justify-center">
            <div class="elevator-shaft">
                <div id="visualsContainer"></div>
                <div id="elevatorCar" class="elevator-car"></div>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="upButton" class="button button-up">Go Up</button>
            <button id="downButton" class="button button-down">Go Down</button>
        </div>
        <button id="musicButton" class="button button-music">Play Lo-fi Music</button>

        <!-- Hidden YouTube iframe for music playback -->
        <div id="youtubePlayerContainer" style="display: none;">
            <iframe id="youtubePlayer"
                    width="1" height="1"
                    src="https://www.youtube.com/embed/jfKfPfyJRdk?enablejsapi=1&autoplay=0&loop=1&playlist=jfKfPfyJRdk"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
            </iframe>
        </div>
    </div>

    <script type="module">
        // Mandatory Firebase initialization code
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let player;
        let elevatorSpeed = 2;
        let currentY = 0;
        let direction = 0; // 0=stopped, 1=up, -1=down
        let animationFrameId;
        const shaftHeight = 600;
        const carHeight = 100;

        // Visuals variables
        let visuals = [];
        let visualSpawnCounter = 0;

        // Get references to DOM elements
        const elevatorCar = document.getElementById('elevatorCar');
        const visualsContainer = document.getElementById('visualsContainer');
        const upButton = document.getElementById('upButton');
        const downButton = document.getElementById('downButton');
        const musicButton = document.getElementById('musicButton');

        // Function to create a star for the "up" journey
        function createStar() {
            const el = document.createElement('div');
            el.className = 'star';
            const size = Math.random() * 3 + 1; // 1px to 4px
            el.style.width = `${size}px`;
            el.style.height = `${size}px`;
            el.style.left = `${Math.random() * 100}%`;
            el.style.opacity = Math.random() * 0.5 + 0.5;

            const visual = {
                el: el,
                y: shaftHeight, // Start at the bottom
                speed: Math.random() * 1.5 + 0.5 // Slower stars for parallax
            };
            visuals.push(visual);
            visualsContainer.appendChild(el);
        }

        // Function to create a rock for the "down" journey
        function createRock() {
            const el = document.createElement('div');
            el.className = 'rock';
            const size = Math.random() * 20 + 10;
            el.style.width = `${size}px`;
            el.style.height = `${size}px`;
            el.style.left = `${Math.random() * 100}%`;
            el.style.backgroundColor = `rgb(${80 + Math.random()*40}, ${50 + Math.random()*20}, ${20 + Math.random()*10})`;
            el.style.borderRadius = `${Math.random() * 50}%`;
            el.style.transform = `rotate(${Math.random() * 360}deg)`;

            const visual = {
                el: el,
                y: -size, // Start just above the view
                speed: Math.random() * 1.5 + 1
            };
            visuals.push(visual);
            visualsContainer.appendChild(el);
        }

        // Main animation loop for the elevator and visuals
        function animate() {
            if (direction !== 0) {
                // Animate Elevator (illusion of staying centered)
                currentY -= direction * elevatorSpeed;
                elevatorCar.style.transform = `translate(-50%, -50%) translateY(${currentY}px)`;

                // Reset elevator position for infinite scroll illusion
                if (direction === 1 && currentY < -(shaftHeight / 2) - carHeight) {
                    currentY += shaftHeight;
                }
                if (direction === -1 && currentY > (shaftHeight / 2) + carHeight) {
                    currentY -= shaftHeight;
                }

                // Animate visuals
                visuals.forEach((visual, index) => {
                    visual.y -= direction * visual.speed * 2; // Move visuals opposite to elevator car's scroll
                    visual.el.style.top = `${visual.y}px`;

                    // Remove visuals that are off-screen
                    if ((direction === 1 && visual.y < -visual.el.offsetHeight) || (direction === -1 && visual.y > shaftHeight)) {
                        visualsContainer.removeChild(visual.el);
                        visuals.splice(index, 1);
                    }
                });

                // Spawn new visuals periodically
                visualSpawnCounter++;
                if (visualSpawnCounter > 15) {
                    if (direction === 1) createRock(); // Going up, rocks pass by downwards
                    else if (direction === -1) createStar(); // Going down, stars pass by upwards
                    visualSpawnCounter = 0;
                }
            }
            animationFrameId = requestAnimationFrame(animate);
        }
        
        // Clear all visuals, e.g., when changing direction
        function clearVisuals() {
            visuals.forEach(visual => visualsContainer.removeChild(visual.el));
            visuals = [];
        }

        function setDirection(newDirection) {
            if (direction !== newDirection) clearVisuals();
            
            if (direction === newDirection) direction = 0;
            else direction = newDirection;

            if (direction === 0) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            } else if (!animationFrameId) {
                animate();
            }
        }
        
        // --- YouTube Player Logic ---
        function loadYouTubeIframeAPI() {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
        window.onYouTubeIframeAPIReady = function() {
            player = new YT.Player('youtubePlayer', { events: { 'onReady': onPlayerReady } });
        };
        function onPlayerReady(event) {
            musicButton.addEventListener('click', () => {
                const playerState = player.getPlayerState();
                if (playerState === YT.PlayerState.PLAYING || playerState === YT.PlayerState.BUFFERING) {
                    player.pauseVideo();
                    musicButton.textContent = 'Play Lo-fi Music';
                } else {
                    player.playVideo();
                    musicButton.textContent = 'Pause Lo-fi Music';
                }
            });
            player.setLoop(true);
        }

        // Event listeners
        upButton.addEventListener('click', () => setDirection(1));
        downButton.addEventListener('click', () => setDirection(-1));
        window.onload = loadYouTubeIframeAPI;
    </script>
</body>
</html>
